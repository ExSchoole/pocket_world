#parse("layout/macros.vm")
#head("City Resources")

#@body()
<div class="row">
    <a href="#springUrl('/city/center/')" class="btn btn-primary">#springMessage('city.center')</a>
</div>
<div class="col-md-7">
    <h1>${dto.NickName}'s city resources</h1>
    #showResources(${dto.getResourceDto().getGold()},${dto.getResourceDto().getTimber()},${dto.getResourceDto().getClay()},${dto.getResourceDto().getCorn()})
    <div class="row">
        #foreach($position in [1,2,3,4])
            <div class="col-md-3">
                #showbuilding($dto.getResourceBuildings(), $position )
            </div>
        #end

    </div>

    <div class="row">
        <div class="col-md-3">
            #foreach($position in [5,6])
                   #showbuilding($dto.getResourceBuildings(), $position )
               #end
        </div>

        <div class="col-md-6">
            <div class="central_image res_building_position"></div>
        </div>

        <div class="col-md-3">
            #foreach($position in [7,8])
                 #showbuilding($dto.getResourceBuildings(), $position )
               #end
        </div>

    </div>

    <div class="row">
        #foreach($position in [9,10,11,12])
            <div class="col-md-3">
                #showbuilding($dto.getResourceBuildings(), $position )
            </div>
        #end
    </div>

</div>

<script type="text/javascript" src="#springUrl('/js/jquery-2.1.4.min.js')"></script>
<script type="text/javascript" src="#springUrl('/js/bootstrap.min.js')"></script>
<script type="text/javascript" src="#springUrl('/js/popupUtil.js')"></script>
<script type="text/javascript" src="#springUrl('/js/cityResources.js')"></script>

<script type="text/javascript">
    CityResources(".building_empty", ".building", "#springUrl('/city/resources/buildings/')", "#springUrl('/city/resources/types')");

    function fillAvailableTypes() {
        $.ajax({
            url: "#springUrl('/city/resources/types')",
            dataType: 'json',
            type: "GET",
            success: function (types) {
                debugger
                availableTypes = types.concat(types)
            },
            error: function (xhr, status, errorThrown) {
                console.log("Error: " + errorThrown);
            }
        })
    }
/*
    var availalbeTypes = []
    fillAvailableTypes()

    $(function () {
        $("div.building_empty").click(function () {
            var div = $(this);
            var position = $(this).attr('id');

            showPopover(div, "Build", generateListOfLinks(position, availalbeTypes))
        });

        $("div.container .popover_item").on("click", function (event) {
            event.preventDefault();
            var position = $(this).attr('position');
            var type = $(this).attr('type');

            $.ajax({
                url: ,
                contentType: "application/json",
                type: "POST",
                success: function (json) {
                    $("div#" + position).removeClass("building_empty").addClass("res_building_" +type);
                    destroyPopover("div#" + position);
                },
                error: function (xhr, status, errorThrown) {
                    alert("Error occured:" + errorThrown);
                    console.log("Error: " + errorThrown);
                    console.log("Status:" + status);
                    console.dir(xhr);
                }
            })
        })

        $("body").on('click', function () {
            hideAllPopovers();
        })
    });


    function generateListOfLinks(json, position){
        var result = '';
        $.each(json, function(index, element){
            result+="<a href='#' class='popover_item' position="+position+" type="+element+">"+element+"</a><br>" ;
        })
        console.log(result);
        return result;
    }

    function fillAvailableTypes() {
        $.ajax({
            url: "#springUrl('/city/resources/types')",
            dataType: 'json',
            type: "GET",
            success: function (types) {
                debugger
                availalbeTypes = types.concat(types)
            },
            error: function (xhr, status, errorThrown) {
                console.log("Error: " + errorThrown);
            }
        })
    }
*/

</script>
#end